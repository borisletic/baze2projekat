-- DDL Script za kreiranje tabela
-- Univerzitetsko udruženje alumnista

-- Kreiranje osnovnih tabela

CREATE TABLE UNIVERZITET (
    idU INT PRIMARY KEY,
    NazU VARCHAR(100) NOT NULL,
    LokU VARCHAR(200) NOT NULL
);

CREATE TABLE TIP_DOGAĐAJA (
    idTd INT PRIMARY KEY,
    NazTd VARCHAR(100) NOT NULL,
    OpisTd TEXT
);

CREATE TABLE DONATOR (
    idDonatora INT PRIMARY KEY,
    NazDonatora VARCHAR(100) NOT NULL
);

CREATE TABLE GRAD (
    idG INT PRIMARY KEY,
    NazG VARCHAR(100) NOT NULL
);

CREATE TABLE LOKACIJA (
    idL INT PRIMARY KEY,
    NazL VARCHAR(100) NOT NULL
);

CREATE TABLE ALUMNI_ODSEK (
    idAlOd INT PRIMARY KEY,
    NazAlOd VARCHAR(100) NOT NULL
);

CREATE TABLE KOORDINATOR (
    idK INT PRIMARY KEY,
    NazK VARCHAR(100) NOT NULL,
    idK_nadređeni INT,
    FOREIGN KEY (idK_nadređeni) REFERENCES KOORDINATOR(idK)
);

CREATE TABLE DOGAĐAJ (
    idD INT PRIMARY KEY,
    NazD VARCHAR(100) NOT NULL,
    OpisD TEXT,
    DatD DATE NOT NULL
);

CREATE TABLE SESIJA (
    idS INT PRIMARY KEY,
    OpisS TEXT,
    idD INT NOT NULL,
    FOREIGN KEY (idD) REFERENCES DOGAĐAJ(idD) ON DELETE CASCADE
);

CREATE TABLE PRIZNANJE (
    idP INT PRIMARY KEY,
    NazP VARCHAR(100) NOT NULL,
    idD INT NOT NULL,
    FOREIGN KEY (idD) REFERENCES DOGAĐAJ(idD) ON DELETE CASCADE
);

CREATE TABLE GRUPNO_PRIZNANJE (
    idP INT PRIMARY KEY,
    NazivTima VARCHAR(100) NOT NULL,
    FOREIGN KEY (idP) REFERENCES PRIZNANJE(idP) ON DELETE CASCADE
);

CREATE TABLE POJEDINAČNO_PRIZNANJE (
    idP INT PRIMARY KEY,
    FOREIGN KEY (idP) REFERENCES PRIZNANJE(idP) ON DELETE CASCADE
);

CREATE TABLE ALUMNUS (
    idAlumn INT PRIMARY KEY,
    NazAlumn VARCHAR(100) NOT NULL,
    idAlOd INT,
    FOREIGN KEY (idAlOd) REFERENCES ALUMNI_ODSEK(idAlOd)
);

CREATE TABLE AKTIVNOST (
    rbrA INT,
    idS INT,
    opisA TEXT,
    idL INT,
    PRIMARY KEY (rbrA, idS),
    FOREIGN KEY (idS) REFERENCES SESIJA(idS) ON DELETE CASCADE,
    FOREIGN KEY (idL) REFERENCES LOKACIJA(idL)
);

-- Vezne tabele za M:N veze

CREATE TABLE ORGANIZUJE (
    idU INT,
    idD INT,
    PRIMARY KEY (idU, idD),
    FOREIGN KEY (idU) REFERENCES UNIVERZITET(idU) ON DELETE CASCADE,
    FOREIGN KEY (idD) REFERENCES DOGAĐAJ(idD) ON DELETE CASCADE
);

CREATE TABLE PRIPADA (
    idD INT,
    idTd INT,
    PRIMARY KEY (idD, idTd),
    FOREIGN KEY (idD) REFERENCES DOGAĐAJ(idD) ON DELETE CASCADE,
    FOREIGN KEY (idTd) REFERENCES TIP_DOGAĐAJA(idTd) ON DELETE CASCADE
);

CREATE TABLE SPONZORIŠE (
    idDonatora INT,
    idD INT,
    PRIMARY KEY (idDonatora, idD),
    FOREIGN KEY (idDonatora) REFERENCES DONATOR(idDonatora) ON DELETE CASCADE,
    FOREIGN KEY (idD) REFERENCES DOGAĐAJ(idD) ON DELETE CASCADE
);

CREATE TABLE KOORDINIRA (
    idK INT,
    rbrA INT,
    idS INT,
    PRIMARY KEY (idK, rbrA, idS),
    FOREIGN KEY (idK) REFERENCES KOORDINATOR(idK) ON DELETE CASCADE,
    FOREIGN KEY (rbrA, idS) REFERENCES AKTIVNOST(rbrA, idS) ON DELETE CASCADE
);

CREATE TABLE NALAZI_SE (
    idL INT,
    idG INT,
    PRIMARY KEY (idL, idG),
    FOREIGN KEY (idL) REFERENCES LOKACIJA(idL) ON DELETE CASCADE,
    FOREIGN KEY (idG) REFERENCES GRAD(idG) ON DELETE CASCADE
);

CREATE TABLE UČESTVUJE (
    idAlumn INT,
    idD INT,
    PRIMARY KEY (idAlumn, idD),
    FOREIGN KEY (idAlumn) REFERENCES ALUMNUS(idAlumn) ON DELETE CASCADE,
    FOREIGN KEY (idD) REFERENCES DOGAĐAJ(idD) ON DELETE CASCADE
);

CREATE TABLE DOBIJA_PRIZNANJE (
    idAlumn INT,
    idP INT,
    PRIMARY KEY (idAlumn, idP),
    FOREIGN KEY (idAlumn) REFERENCES ALUMNUS(idAlumn) ON DELETE CASCADE,
    FOREIGN KEY (idP) REFERENCES POJEDINAČNO_PRIZNANJE(idP) ON DELETE CASCADE
);

-- Kreiranje indeksa za poboljšanje performansi
CREATE INDEX idx_sesija_dogadjaj ON SESIJA(idD);
CREATE INDEX idx_priznanje_dogadjaj ON PRIZNANJE(idD);
CREATE INDEX idx_aktivnost_sesija ON AKTIVNOST(idS);
CREATE INDEX idx_aktivnost_lokacija ON AKTIVNOST(idL);
CREATE INDEX idx_alumnus_odsek ON ALUMNUS(idAlOd);
CREATE INDEX idx_koordinator_nadredjeni ON KOORDINATOR(idK_nadređeni);